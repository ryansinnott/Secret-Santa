<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Game - Silly Santa</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üéÖ</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;0,700;1,400&family=DM+Sans:ital,opsz,wght@0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>Silly Santa</h1>

        <!-- Host Setup -->
        <div id="revealed-setup">
            <h2>Choose Entry Method</h2>

            <div class="entry-method-cards">
                <button class="entry-method-card" onclick="showQRMode()">
                    <div class="entry-icon">üì±</div>
                    <h3>QR Code</h3>
                    <p>Players scan to join on their phones</p>
                </button>

                <button class="entry-method-card" onclick="showManualMode()">
                    <div class="entry-icon">‚úèÔ∏è</div>
                    <h3>Manual Entry</h3>
                    <p>Enter names yourself on this device</p>
                </button>
            </div>

            <a href="index.html" id="back-to-home" class="back-link">‚Üê Back to home</a>

            <!-- QR Code Mode -->
            <div id="qr-mode" class="hidden">
                <button id="create-room-btn" onclick="createRoom()">
                    Generate QR Code
                </button>

                <div id="room-info" class="hidden">
                    <div class="qr-container">
                        <img id="qr-code" src="" alt="QR Code">
                    </div>

                    <div class="room-code-display">
                        <span>Room Code:</span>
                        <strong id="room-code-text">------</strong>
                    </div>

                    <div id="waiting-players">
                        <h3>Players Joined (<span id="joined-count">0</span>)</h3>
                        <ul id="joined-list"></ul>
                    </div>

                    <div class="qr-add-player">
                        <div class="input-group">
                            <input type="text" id="qr-manual-name" placeholder="Add player manually" autocomplete="off">
                            <button onclick="addQRManualPlayer()">Add</button>
                        </div>
                    </div>

                    <button id="start-revealed-btn" onclick="startRevealedGame()" disabled>
                        Assign Numbers
                    </button>

                    <div class="option-toggle">
                        <label class="toggle-checkbox">
                            <input type="checkbox" id="hide-order-toggle">
                            <span>Hide order</span>
                        </label>
                        <span class="help-icon" onclick="showHideOrderHelp()">?</span>
                    </div>
                </div>
            </div>

            <!-- Manual Entry Mode -->
            <div id="manual-mode" class="hidden">
                <div class="input-group">
                    <input type="text" id="manual-name-input" placeholder="Enter a name" autocomplete="off">
                    <button id="manual-add-btn" onclick="addManualName()">Add</button>
                </div>

                <div id="manual-names-list">
                    <h3>Players (<span id="manual-player-count">0</span>)</h3>
                    <ul id="manual-player-list"></ul>
                </div>

                <button id="manual-start-btn" onclick="startManualGame()" disabled>
                    Assign Numbers
                </button>

                <div class="option-toggle">
                    <label class="toggle-checkbox">
                        <input type="checkbox" id="mystery-mode-toggle">
                        <span>Mystery mode</span>
                    </label>
                    <span class="help-icon" onclick="showMysteryModeHelp()">?</span>
                </div>
            </div>

            <button id="back-to-methods" class="back-link hidden" onclick="showMethodSelection()">
                ‚Üê Back to entry methods
            </button>
        </div>

        <!-- Game Started (Host View) - Ladder -->
        <div id="revealed-ladder" class="hidden">
            <div class="game-code-display">
                <span>Game Code:</span>
                <strong id="game-code-text">------</strong>
            </div>
            <h2>The Order</h2>
            <div class="ladder-container">
                <ol id="ladder-list"></ol>
            </div>

            <div class="option-toggle">
                <label class="toggle-checkbox">
                    <input type="checkbox" id="show-order-toggle" checked onchange="toggleOrderVisibility()">
                    <span>Show order</span>
                </label>
            </div>

            <button id="add-participant-btn" onclick="showAddParticipant()">
                + Add Participant
            </button>

            <button onclick="restart()" id="restart-btn">
                Start New Game
            </button>
        </div>

        <!-- Mystery Mode Reveal Phase -->
        <div id="mystery-reveal" class="hidden">
            <div class="reveal-card">
                <div class="number-badge">
                    #<span id="mystery-current-number">1</span>
                </div>
                <div class="name-reveal">
                    <span id="mystery-current-name">Name</span>
                </div>
            </div>

            <p class="progress">
                <span id="mystery-current-index">1</span> of <span id="mystery-total-players">0</span>
            </p>

            <button id="mystery-next-btn" onclick="mysteryNextPerson()">
                Next Person
            </button>

            <button id="mystery-restart-btn" class="hidden" onclick="restart()">
                Start Over
            </button>
        </div>

        <!-- Add Participant Modal -->
        <div id="add-participant-modal" class="modal hidden">
            <div class="modal-content">
                <h3>Add Participant</h3>
                <div class="input-group-vertical">
                    <label for="new-participant-name">Name</label>
                    <input type="text" id="new-participant-name" placeholder="Enter name" autocomplete="off">
                </div>
                <div class="position-options">
                    <label class="radio-option">
                        <input type="radio" name="position" value="random" checked>
                        <span>Random position</span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="position" value="last">
                        <span>Last position</span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="position" value="specific">
                        <span>Specific position:</span>
                        <input type="number" id="specific-position" min="1" placeholder="#">
                    </label>
                </div>
                <div class="modal-buttons">
                    <button onclick="hideAddParticipant()" class="cancel-btn">Cancel</button>
                    <button onclick="addParticipant()" class="confirm-btn">Add</button>
                </div>
            </div>
        </div>

        <!-- Confirm Remove Modal -->
        <div id="confirm-remove-modal" class="modal hidden">
            <div class="modal-content">
                <h3>Remove Participant?</h3>
                <p>Are you sure you want to remove <strong id="remove-name"></strong>? This cannot be undone.</p>
                <div class="modal-buttons">
                    <button onclick="hideConfirmRemove()" class="cancel-btn">Cancel</button>
                    <button onclick="confirmRemove()" class="confirm-btn danger">Remove</button>
                </div>
            </div>
        </div>

        <!-- Mystery Mode Help Modal -->
        <div id="mystery-help-modal" class="help-modal hidden">
            <div class="help-modal-content">
                <h3>Mystery Mode</h3>
                <p>In Mystery Mode, players are revealed one at a time with their assigned number. Pass the device around - no one knows who's next until they see their name appear!</p>
                <button onclick="hideHelpModal('mystery-help-modal')">Got it!</button>
            </div>
        </div>

        <!-- Hide Order Help Modal -->
        <div id="hide-order-help-modal" class="help-modal hidden">
            <div class="help-modal-content">
                <h3>Hide Order</h3>
                <p>When enabled, the order list won't be shown on your screen after numbers are assigned. Players will only see their own number on their phone. You can turn this on or off at any time.</p>
                <button onclick="hideHelpModal('hide-order-help-modal')">Got it!</button>
            </div>
        </div>
    </div>

    <script>
        // Set global basePath for subpath hosting support
        window.basePath = window.location.pathname.replace(/\/[^/]*$/, '');

        // Dynamically load socket.io from the correct path
        var script = document.createElement('script');
        script.src = window.basePath + '/socket.io/socket.io.js';
        script.onload = function() {
            // Load revealed.js after socket.io is ready
            var appScript = document.createElement('script');
            appScript.src = 'revealed.js';
            document.body.appendChild(appScript);
        };
        document.body.appendChild(script);
    </script>
</body>
</html>
